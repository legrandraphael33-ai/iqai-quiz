<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>IQAI Test - I Quit AI</title>

<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=Inter:wght@400;700;900&display=swap" rel="stylesheet">

<style>
*{box-sizing:border-box;margin:0;padding:0;}

body{
  min-height:100vh;
  background:linear-gradient(135deg,#f0c79e,#e3a56b);
  font-family:Inter,system-ui,sans-serif;
  display:flex;
  justify-content:center;
  padding:20px;
}

.hidden{display:none}

/* ===== CONTAINER ===== */
.container{
  width:100%;
  max-width:560px;
  background:#fff;
  border-radius:18px;
  padding:26px;
  box-shadow:0 10px 28px rgba(0,0,0,.18);
}

/* ===== TITLE ===== */
h1{
  font-family:'Press Start 2P', monospace;
  font-size:clamp(1.4rem,5vw,2.2rem);
  text-align:center;
  margin-bottom:6px;
  white-space:nowrap;
}
h1 span{display:inline-block}

.subtitle{
  text-align:center;
  font-weight:900;
  color:#fff;
  margin-bottom:18px;
}

.title-sep{
  margin:0 8px;
  color:#fff;
  opacity:0;
}
.cursor{
  animation:blink 1s steps(2,start) infinite;
}
@keyframes blink{
  0%{opacity:1}
  50%{opacity:0}
  100%{opacity:1}
}

/* ===== START SLIDER ===== */
#sliderTrack{
  position:relative;
  height:56px;
  background:#263238;
  border-radius:14px;
  overflow:hidden;
  touch-action:none;
}
#sliderThumb{
  position:absolute;
  left:0;
  top:0;
  width:56px;
  height:56px;
  background:#ff8f00;
  border-radius:14px;
  display:flex;
  align-items:center;
  justify-content:center;
  font-weight:900;
  font-size:20px;
  color:#000;
  cursor:pointer;
}
.sliderText{
  position:absolute;
  width:100%;
  text-align:center;
  line-height:56px;
  color:#fff;
  font-weight:900;
  pointer-events:none;
  opacity:.7;
}

/* ===== QUIZ ===== */
.question{
  font-weight:900;
  margin-bottom:10px;
}
.options button{
  width:100%;
  margin:6px 0;
  padding:12px;
  border:none;
  border-radius:12px;
  background:#ff8f00;
  color:#fff;
  font-weight:900;
}
.options button.selected{
  background:#263238;
}
#nextBtn{
  margin-top:10px;
  width:100%;
  padding:12px;
  border:none;
  border-radius:12px;
  background:#263238;
  color:#fff;
  font-weight:900;
}
#timer{
  text-align:center;
  font-weight:900;
  margin-bottom:8px;
}

/* ===== TOKEN ===== */
#tokenContainer{
  margin:20px auto;
  max-width:420px;
  text-align:center;
}
#tokenImage,#tokenCanvas{
  width:100%;
  border-radius:14px;
}
</style>
</head>

<body>

<div class="container">

<!-- ===== START SCREEN ===== -->
<div id="startScreen">
  <h1 id="title"></h1>
  <p class="subtitle">I Quit AI</p>

  <div id="sliderTrack">
    <div id="sliderThumb">▶</div>
    <span class="sliderText">Glisse pour démarrer</span>
  </div>
</div>

<!-- ===== QUIZ ===== -->
<div id="quiz" class="hidden">
  <div id="timer"></div>
  <div id="questionContainer"></div>
  <div class="options" id="optionsContainer"></div>
  <button id="nextBtn" disabled>Suivant</button>
</div>

<!-- ===== RESULT ===== -->
<div id="result" class="hidden">
  <p id="scoreDisplay"></p>
</div>

<audio id="bootAudio" src="Gameboy.mp3" preload="auto"></audio>

<script>
/* ===== TITLE BOOT ===== */
const colors=["#FF4136","#FFDC00","#2ECC40","#0074D9","#FF851B","#B10DC9"];
const title=document.getElementById("title");
const parts=["IQAI","Test"];
let colorIndex=0;

function addColored(text){
  text.split("").forEach((c,i)=>{
    const s=document.createElement("span");
    s.textContent=c;
    s.style.opacity="0";
    s.style.color=colors[(colorIndex+i)%colors.length];
    title.appendChild(s);
    setTimeout(()=>{s.style.opacity="1"},200*i);
  });
  colorIndex+=text.length;
}

function playBootTitle(){
  title.innerHTML="";
  colorIndex=0;

  addColored(parts[0]);

  const sep=document.createElement("span");
  sep.textContent=" | ";
  sep.className="title-sep";
  title.appendChild(sep);

  addColored(parts[1]);

  setTimeout(()=>{
    sep.style.opacity="1";
    sep.classList.add("cursor");
  },1800); // synchro fin jingle
}

/* ===== SLIDER LOGIC (FIXED) ===== */
const thumb=document.getElementById("sliderThumb");
const track=document.getElementById("sliderTrack");
let dragging=false;
let startX=0;

thumb.addEventListener("pointerdown",e=>{
  dragging=true;
  startX=e.clientX - thumb.offsetLeft;
  thumb.setPointerCapture(e.pointerId);
});

thumb.addEventListener("pointermove",e=>{
  if(!dragging) return;
  const max=track.clientWidth - thumb.clientWidth;
  let x=e.clientX - startX;
  x=Math.max(0,Math.min(x,max));
  thumb.style.left=x+"px";

  if(x>=max-2){
    dragging=false;
    startGame();
  }
});

thumb.addEventListener("pointerup",resetThumb);
thumb.addEventListener("pointercancel",resetThumb);

function resetThumb(){
  if(!dragging) return;
  dragging=false;
  thumb.style.left="0px";
}

/* ===== GAME START ===== */
const startScreen=document.getElementById("startScreen");
const quiz=document.getElementById("quiz");
const bootAudio=document.getElementById("bootAudio");

async function startGame(){
  startScreen.classList.add("hidden");
  quiz.classList.remove("hidden");

  playBootTitle();

  try{
    bootAudio.currentTime=0;
    await bootAudio.play();
  }catch{}

  await loadQuestions();
  showQuestion();
}

/* ===== QUIZ LOGIC ===== */
const API_URL="https://iqai-backend.vercel.app/api/quiz";
let questions=[],current=0,score=0,userAnswers=[];
let timeLeft=30,timerInterval=null;

async function loadQuestions(){
  const res=await fetch(API_URL,{method:"POST"});
  questions=await res.json();
}

const questionContainer=document.getElementById("questionContainer");
const optionsContainer=document.getElementById("optionsContainer");
const nextBtn=document.getElementById("nextBtn");
const timer=document.getElementById("timer");

function startTimer(){
  clearInterval(timerInterval);
  timeLeft=30;
  updateTimer();
  timerInterval=setInterval(()=>{
    timeLeft--;
    updateTimer();
    if(timeLeft<=0){
      clearInterval(timerInterval);
      nextBtn.click();
    }
  },1000);
}

function updateTimer(){
  timer.textContent=`⏱ ${timeLeft}s`;
  timer.style.color=timeLeft<=5?"#e53935":"#333";
}

function showQuestion(){
  const q=questions[current];
  questionContainer.textContent=q.q;
  optionsContainer.innerHTML="";
  nextBtn.disabled=true;

  q.options.forEach(opt=>{
    const b=document.createElement("button");
    b.textContent=opt;
    b.onclick=()=>{
      userAnswers[current]=opt;
      b.classList.add("selected");
      nextBtn.disabled=false;
    };
    optionsContainer.appendChild(b);
  });

  startTimer();
}

nextBtn.onclick=()=>{
  clearInterval(timerInterval);
  if(userAnswers[current]===questions[current].answer) score++;
  current++;
  current<questions.length ? showQuestion() : showResult();
};

function showResult(){
  quiz.classList.add("hidden");
  result.classList.remove("hidden");
  scoreDisplay.textContent=`Score final : ${score}/10`;
}
</script>
</body>
</html>
